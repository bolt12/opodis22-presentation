\documentclass{beamer}

\setbeamertemplate{frametitle}[default][center] % Centering the frame title
\usetheme[iohk]{welltyped}
\usepackage{graphicx}
\usepackage{soul}
\usepackage{tabularx}
\usepackage{multirow}
\usepackage{colortbl}
\usepackage{wrapfig}
\usepackage{caption}
\graphicspath{ {../includes/} }

\begin{document}

\title{Building a Distributed System with Real-time Constraints}
\subtitle{Using concurrent Functional Programming tools}
\author{Armando Santos}
\date{\today}
\maketitle

\AtBeginSection[]{
  \begin{frame}
  \vfill
  \centering
  \begin{beamercolorbox}[sep=8pt,center,shadow=true,rounded=true]{title}
    \usebeamerfont{title}\insertsectionhead\par%
  \end{beamercolorbox}
  \vfill
  \end{frame}
}

\section{Introduction}
\subsection*{Networking Team}
\begin{frame}{Networking Team}
  \begin{columns}
    \column{.33\linewidth}
    \centering
    Armando Santos \\ Well-Typed
    \column{.34\linewidth}
    \centering
    Marcin Szamotulski \\ Input Output Global
    \column{.33\linewidth}
    \centering
    Duncan Coutts \\ Well-Typed
  \end{columns}
  \vskip1cm
  \begin{columns}
    \column{.4\linewidth}
    \centering
    Neil Davies \\ PNSol
    \column{.4\linewidth}
    \centering
    Peter Thompson \\ PNSol
  \end{columns}
\end{frame}

\section{What we are responsible for at the networking team}

\subsection*{Cardano Node}
\begin{frame}{Cardano Node}
  \centering

  \begin{figure}[h]
    \includegraphics[width=0.3\textwidth, height=0.2\textheight]{cardano.png}
  \end{figure}

  \vskip-0.5cm

  \begin{table}[]
    \centering
    \resizebox{\textwidth}{!}{%
      \begin{tabular}{llll}
        \multicolumn{1}{c}{\alert{\textbf{Ouroboros algorithm paper}}} &
        \multicolumn{1}{c}{\alert{\textbf{Refining step}}} &
        \multicolumn{1}{c}{\alert{\textbf{Implementation}}} &
        \multicolumn{1}{c}{\alert{\textbf{Testing}}} \\ \\
        \multicolumn{1}{l|}{\begin{tabular}[c]{@{}l@{}}Formal Specification\\ \\  Threat models\\ \\  Non-realistic assumptions\\ \\  Performance objectives\end{tabular}} &
        \multicolumn{1}{l|}{\begin{tabular}[c]{@{}l@{}}Real time constraints\\ \\  Concurrency\\ \\  Operation \& Performance\end{tabular}} &
        \multicolumn{1}{l|}{\begin{tabular}[c]{@{}l@{}}Architecture \& Design\\ \\  Protocols\\ \\  Scale\\ \\  Exceptions \& Corner cases\end{tabular}} &
        \begin{tabular}[c]{@{}l@{}}Properties\\ \\  Simulation\\ \\  Reliability\\ \\  CI\end{tabular}
      \end{tabular}%
    }
  \end{table}
\end{frame}

\section{Presentation overview}

\section{The Challenge: Real-time Distributed System}

\begin{frame}{Cardano's Vision of a Distributed System}
  \begin{itemize}
    \item It's a distributed system, but
    \begin{itemize}
      \item Latency
      \item Scalability
      \item Fault Tolerance
      \item Honest stake assumption
      \item Real-time constraints
      \item Adversarial behavior
    \end{itemize}
  \end{itemize}

\end{frame}

\section{Constraints, Assumptions, and Implementation Challenges in Cardano}

\begin{frame}{Faithfulness to Research vs. Real-World Implementation}
  \begin{figure}[h]
      \centering
      \begin{minipage}{0.45\textwidth}
          \centering
          \includegraphics[width=0.9\linewidth]{paper.png} % Adjust the width as necessary
          \caption{Ouroboros paper}
      \end{minipage}\hfill
      \begin{minipage}{0.45\textwidth}
          \centering
          \includegraphics[width=0.9\linewidth]{code2.png} % Adjust the width as necessary
          \caption{Code base}
      \end{minipage}
  \end{figure}
\end{frame}

\begin{frame}{Need to fill the gap}
  \begin{itemize}
    \item Translate formal specification into code
    \item Highly concurrent logic
    \item High assurance needs (i.e. as verifiable and robust as possible)
    \item Clear code structures, predictable behavior
  \end{itemize}
\end{frame}

\section{Strongly Statically Typed Purely Functional Programming}

\begin{frame}{Haskell}
  \begin{figure}
    \centering
    \includegraphics[height=0.55\textheight]{10reasonsWhy.png}
    \caption{\href{https://imgur.com/i0wTFSO.png}{Source}}
  \end{figure}

  But:
  \begin{itemize}
    \item Memory consumption
    \item Debugging can be tricky
  \end{itemize}
\end{frame}

\begin{frame}{In a nutshell}
  \begin{figure}
    \centering
    \includegraphics[height=0.8\textheight]{whyfp.png}
    \caption{\href{https://imgur.com/EeMZL0I.png}{Source}}
  \end{figure}
\end{frame}

\section{Tools \& Techniques}

\begin{frame}{Software Transactional Memory (STM)}
  \begin{itemize}
    \item Compositional and modular concurrency
    \item Isolated from IO side effects
  \end{itemize}
\end{frame}

\begin{frame}{Abstraction \& Libraries}
  \begin{minipage}{0.6\textwidth} % Adjust the width as needed
    \begin{itemize}
      \item First to finish vs Last to finish STM semantics
      \item Typed-protocols
         \begin{itemize}
           \item Type safe
           \item Session types
           \item \alert{Deadlock free!}
         \end{itemize}
    \end{itemize}
  \end{minipage}%
  \begin{minipage}{0.4\textwidth} % Adjust the width as needed
    \begin{figure}[h]
      \includegraphics[width=0.85\linewidth]{abstraction.png} % Replace with the path to your image
    \end{figure}
    \begin{figure}[h]
      \includegraphics[width=0.85\linewidth]{peerSharing.png} % Replace with the path to your image
    \end{figure}
  \end{minipage}
\end{frame}

\begin{frame}{Testing approach}
  \begin{itemize}
    \item Property based testing vs unit tests
       \begin{itemize}
         \item \alert{Input random generation};
         \item Shrinking;
         \item \alert{Reproducibility};
         \item Coverage checks.
       \end{itemize}
    \item Simulation
       \begin{itemize}
         \item Early detection of critical races;
         \item Simulation of rare \alert{edge cases};
         \item Mocking and \alert{error injection};
         \item Simulate time passing;
         \item Looking for \alert{different schedules}.
       \end{itemize}
  \end{itemize}
\end{frame}

\section{Highlights from the Networking Team}

\begin{frame}{Highlights}

  Good:
  \begin{itemize}
    \item Found several tricky edge case bugs
    \item Network is running for years non-stop
    \item Simulate years of total time per week!
  \end{itemize}

  But:
  \begin{itemize}
    \item We are far from perfect, we still fix and find small bugs every month related to networking
  \end{itemize}

  We try our best:

  Our CI test suite runs on average between $1$ and $5$ hours of simulated time per test
  per input per PR per OS. So:

  \begin{itemize}
    \item Assuming around 100 tests in our test suite and
    \item each test generates 100 random inputs;
    \item Assuming 3 PRs per week and testing on Windows, OSX and Linux;
    \item Results on around \emph{225 000 hours} of simulated time per week!
  \end{itemize}
\end{frame}

\section{Takeaways}

\begin{frame}{Takeaways}
  \begin{itemize}
    \item Complex systems spans performance characteristics we can not control;
    \item Functional Programming, namely Haskell and its concurrency tools helps us manage complexity;
    \item We do our best in searching through all state space efficiently;
    \item Well-founded confidence;
    \item Progress is achievable.
  \end{itemize}
\end{frame}

\begin{frame}
  \centering
  \usebeamerfont{title}
  Thank you!
\end{frame}

\end{document}

